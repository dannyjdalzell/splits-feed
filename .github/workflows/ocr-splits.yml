name: OCR Splits
on:
  schedule:
    - cron: "*/5 * * * *"
  workflow_dispatch: {}
permissions:
  contents: write
jobs:
  ocr_splits:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with: { fetch-depth: 0 }
      - name: System deps
        run: |
          sudo apt-get update
          sudo apt-get install -y tesseract-ocr
      - name: Run OCR via tesseract CLI
        env:
          TZ: America/Chicago
        run: |
          python3 scripts/splits_ocr.py
      - name: Commit & push CSV changes (conflict-safe)
        run: |
          git config user.name "splits-bot"
          git config user.email "actions@users.noreply.github.com"
          git add splits.csv
          if ! git diff --cached --quiet; then
            git commit -m "OCR: append new split rows"
            git pull --rebase --autostash
            git push
          else
            echo "No changes to commit."
